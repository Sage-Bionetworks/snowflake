version: 2
models:
  - name: int_synapse_access_requirement
    description: "Intermediate model combining access requirement data with its current revision and associated projects. Provides a denormalized view of access requirements with metadata, modification history, and project relationships."
    constraints:
      - type: primary_key
        columns: [access_requirement_id, access_requirement_version]
    columns:
      - name: access_requirement_id
        description: "Unique identifier for the access requirement"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_version
        description: "Revision number of this access requirement. Revision numbers begin from 0."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_name
        description: "Unique human-readable name for the access requirement"
        data_type: VARCHAR
        constraints:
          - type: not_null
      - name: access_requirement_type
        description: "The type of access requirement"
        data_type: VARCHAR
      - name: created_by
        description: "Identifier of the user who created this access requirement"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_on
        description: "UTC timestamp when this access requirement was initially created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: modified_by
        description: "Identifier of the user who created this revision"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: modified_on
        description: "UTC timestamp when this revision was created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: is_two_fa_required
        description: "Boolean flag indicating whether two-factor authentication is required for this access. Null except for the most recent revision."
        data_type: BOOLEAN
      - name: access_type
        description: "Type of access controlled by this requirement"
        data_type: VARCHAR
        constraints:
          - type: not_null
      - name: access_requirement_raw
        description: "Serialized representation of the complete access requirement object at this revision"
        data_type: BINARY

  - name: int_synapse_acl
    description: "Intermediate model flattening ACL data to show which principals have which access types for each resource."
    constraints:
      - type: primary_key
        columns: [acl_id, principal_id]
    columns:
      - name: acl_id
        description: "Unique identifier for the ACL (Access Control List). Not to be confused with the entity or object upon which this ACL grants access to."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: object_id
        description: "ID of the entity or object that this ACL grants access to"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: object_type
        description: "Type of entity or object that owns this ACL"
        data_type: VARCHAR
      - name: created_on
        description: "UTC Timestamp when the ACL was created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: etag
        description: "Entity tag for optimistic concurrency control (36-character UUID)"
        data_type: VARCHAR(36)
        constraints:
          - type: not_null
      - name: principal_id
        description: "The user or team being granted access"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_type
        description: "All permission types granted to this principal (e.g., 'READ', 'UPDATE', 'DELETE', 'CHANGE_PERMISSIONS', 'DOWNLOAD', 'CREATE', etc.)."
        data_type: VARIANT
        constraints:
          - type: not_null

  - name: int_synapse_data_access_submission
    description: "Intermediate model combining data access submissions with their current status and aggregated accessor changes. A data access submission is a snapshot of an access request at submission time. When users modify rejected requests, new submissions are created, forming a revision history."
    constraints:
      - type: primary_key
        columns: [data_access_submission_id]
    columns:
      - name: data_access_submission_id
        description: "Unique identifier for the data access submission."
        data_type: NUMBER
        constraints:
          - type: not_null
          - type: unique
      - name: data_access_request_id
        description: "The identifier of the access request that this submission was created from."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_id
        description: "The identifier of the access requirement that the access request associates with."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_version
        description: "Version of the access requirement at the time of submission."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: research_project_id
        description: "The research project associated with this submission."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_by
        description: "Identifier of the user who made this submission."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_on
        description: "UTC timestamp when the submission was created."
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: state_modified_by
        description: "Identifier of the user who last modified the submission status."
        data_type: NUMBER
      - name: state_modified_on
        description: "UTC timestamp when the submission status was last modified."
        data_type: TIMESTAMP_NTZ
      - name: state
        description: "Current state in the submission workflow. One of: 'SUBMITTED', 'APPROVED', 'REJECTED', 'CANCELLED'"
        data_type: VARCHAR
      - name: state_reason
        description: "UTF-8 encoded string containing an explanation for the current state, particularly for rejections or cancellations. Null for records before 2019 due to invalid utf-8 characters."
        data_type: VARCHAR
      - name: etag
        description: "Entity tag for optimistic concurrency control (36-character UUID)."
        data_type: VARCHAR(36)
        constraints:
          - type: not_null
      - name: data_access_submission_raw
        description: "Serialized representation of the complete submission object."
        data_type: BINARY
        constraints:
          - type: not_null
      - name: accessor_changes
        description: "A mapping of principal IDs (as strings) to their access type changes (e.g., {'123': 'GAIN_ACCESS', '456': 'RENEW_ACCESS'}). Access types include: 'GAIN_ACCESS', 'RENEW_ACCESS', 'REVOKE_ACCESS'"
        data_type: VARIANT
