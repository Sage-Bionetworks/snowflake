version: 2
models:
  - name: int_synapse_access_requirement
    description: "Intermediate model combining access requirement data with its current revision and associated projects. Provides a denormalized view of access requirements with metadata, modification history, and project relationships."
    constraints:
      - type: primary_key
        columns: [access_requirement_id, access_requirement_version]
    columns:
      - name: access_requirement_id
        description: "Unique identifier for the access requirement"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_version
        description: "Revision number of this access requirement. Revision numbers begin from 0."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_name
        description: "Unique human-readable name for the access requirement"
        data_type: VARCHAR
        constraints:
          - type: not_null
      - name: access_requirement_type
        description: "The type of access requirement"
        data_type: VARCHAR
      - name: created_by
        description: "Identifier of the user who created this access requirement"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_on
        description: "UTC timestamp when this access requirement was initially created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: modified_by
        description: "Identifier of the user who created this revision"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: modified_on
        description: "UTC timestamp when this revision was created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: is_two_fa_required
        description: "Boolean flag indicating whether two-factor authentication is required for this access. Null except for the most recent revision."
        data_type: BOOLEAN
      - name: access_type
        description: "Type of access controlled by this requirement"
        data_type: VARCHAR
        constraints:
          - type: not_null
      - name: access_requirement_raw
        description: "Serialized representation of the complete access requirement object at this revision"
        data_type: BINARY

  - name: int_synapse_acl
    description: "Intermediate model flattening ACL data to show which principals have which access types for each resource."
    constraints:
      - type: primary_key
        columns: [acl_id, principal_id]
    columns:
      - name: acl_id
        description: "Unique identifier for the ACL (Access Control List). Not to be confused with the entity or object upon which this ACL grants access to."
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: object_id
        description: "ID of the entity or object that this ACL grants access to"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: object_type
        description: "Type of entity or object that owns this ACL"
        data_type: VARCHAR
      - name: created_on
        description: "UTC Timestamp when the ACL was created"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: etag
        description: "Entity tag for optimistic concurrency control (36-character UUID)"
        data_type: VARCHAR(36)
        constraints:
          - type: not_null
      - name: principal_id
        description: "The user or team being granted access"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_type
        description: "All permission types granted to this principal (e.g., 'READ', 'UPDATE', 'DELETE', 'CHANGE_PERMISSIONS', 'DOWNLOAD', 'CREATE', etc.)."
        data_type: VARIANT
        constraints:
          - type: not_null

  - name: int_synapse_data_access_submission
    description: "{{ doc('int_synapse_data_access_submission') }}"
    constraints:
      - type: primary_key
        columns: [data_access_submission_id]
    columns:
      - name: data_access_submission_id
        description: "{{ doc('col_data_access_submission_id') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
          - type: unique
      - name: data_access_request_id
        description: "{{ doc('col_submission_data_access_request_id') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_id
        description: "{{ doc('col_access_requirement_id') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: access_requirement_version
        description: "{{ doc('col_submission_access_requirement_version') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: research_project_id
        description: "{{ doc('col_submission_research_project_id') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_by
        description: "{{ doc('col_submission_created_by') }}"
        data_type: NUMBER
        constraints:
          - type: not_null
      - name: created_on
        description: "{{ doc('col_submission_created_on') }}"
        data_type: TIMESTAMP_NTZ
        constraints:
          - type: not_null
      - name: state_modified_by
        description: "{{ doc('col_submission_state_modified_by') }}"
        data_type: NUMBER
      - name: state_modified_on
        description: "{{ doc('col_submission_state_modified_on') }}"
        data_type: TIMESTAMP_NTZ
      - name: state
        description: "{{ doc('col_submission_state') }}"
        data_type: VARCHAR
      - name: state_reason
        description: "{{ doc('col_submission_state_reason') }}"
        data_type: VARCHAR
      - name: etag
        description: "{{ doc('col_etag') }}"
        data_type: VARCHAR(36)
        constraints:
          - type: not_null
      - name: data_access_submission_raw
        description: "{{ doc('col_data_access_submission_raw') }}"
        data_type: BINARY
        constraints:
          - type: not_null
      - name: accessor_changes
        description: "{{ doc('col_submission_accessor_changes') }}"
        data_type: VARIANT
